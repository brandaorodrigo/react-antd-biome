import { Input, type InputProps } from 'antd';
import { useState } from 'react';
import { GrCreditCard } from 'react-icons/gr';

const company = (value: number | string): string => {
    const patterns = {
        visa: /^4/,
        mastercard: /^(5[1-5]|2[2-7])/,
        amex: /^3[47]/,
        discover: /^(6011|65|64[4-9]|622)/,
        diners: /^(36|38|30[0-5])/,
        jcb: /^(35)/,
        unionpay: /^(62)/,
    };
    const number = String(value).replace(/\s+/g, '');
    const four = number.slice(0, 4);
    for (const [card, pattern] of Object.entries(patterns)) {
        if (pattern.test(four)) {
            return card;
        }
    }
    return '';
};

const Flag: React.FC<{ name?: string }> = ({ name }) => {
    if (name === 'visa') {
        return (
            <svg
                height={20}
                version='1.1'
                viewBox='0 0 500 200'
                width={25}
                xmlns='http://www.w3.org/2000/svg'
            >
                <title>visa</title>
                <path
                    d='M323.3,20.2c-34.6,0-65.5,17.9-65.5,51c0,38,54.8,40.6,54.8,59.7c0,8-9.2,15.2-24.9,15.2c-22.3,0-39-10-39-10 l-7.1,33.4c0,0,19.2,8.5,44.7,8.5c37.8,0,67.5-18.8,67.5-52.5c0-40.1-55-42.7-55-60.4c0-6.3,7.6-13.2,23.2-13.2 c17.7,0,32.1,7.3,32.1,7.3l7-32.3C361.2,27,345.5,20.2,323.3,20.2z M7,22.6l-0.8,4.9c0,0,14.5,2.7,27.6,8 c16.9,6.1,18.1,9.6,20.9,20.6l31,119.4h41.5l63.9-152.9h-41.4l-41.1,103.9L91.9,38.5C90.3,28.4,82.6,22.6,73,22.6H7z M207.8,22.6 l-32.5,152.9h39.5l32.4-152.9H207.8z M428,22.6c-9.5,0-14.6,5.1-18.3,14l-57.8,138.8h41.4l8-23.1h50.4l4.9,23.1h36.5L461.2,22.6H428 z M433.3,63.9l12.3,57.4h-32.9L433.3,63.9z'
                    fill='#1434CB'
                />
            </svg>
        );
    }

    if (name === 'mastercard') {
        return (
            <svg
                height={20}
                version='1.1'
                viewBox='0 0 500 250'
                width={25}
                xmlns='http://www.w3.org/2000/svg'
            >
                <title>mastercard</title>
                <path d='M301,33.2H198.7v183.6H301V33.2z' fill='#FF5A00' />
                <path
                    d='M205.5,125c0-37.3,17.5-70.4,44.5-91.8c-19.8-15.6-44.8-25-72-25C113.4,8.2,61.1,60.4,61.1,125 s52.2,116.8,116.8,116.8c27.3,0,52.2-9.4,72-25C223,195.7,205.5,162.3,205.5,125z'
                    fill='#EB001B'
                />
                <path
                    d='M438.9,125c0,64.6-52.2,116.8-116.8,116.8c-27.3,0-52.2-9.4-72-25c27.3-21.4,44.5-54.5,44.5-91.8 S276.9,54.6,250,33.2c19.8-15.6,44.8-25,72-25C386.6,8.2,438.9,60.8,438.9,125z'
                    fill='#F79E1B'
                />
            </svg>
        );
    }

    if (name === 'diners') {
        return (
            <svg
                height={20}
                version='1.1'
                viewBox='0 0 500 250'
                width={25}
                xmlns='http://www.w3.org/2000/svg'
            >
                <title>diners</title>
                <path
                    d='M406.7,126.7c0-72.2-60.2-122.1-126.3-122h-56.8c-66.8,0-121.8,49.9-121.8,122c0,66,55,120.3,121.8,119.9h56.8 C346.4,247,406.7,192.7,406.7,126.7z'
                    fill='#0079BE'
                />
                <path
                    d='M224,14.9c-61,0-110.5,49.6-110.5,110.8c0,61.2,49.5,110.7,110.5,110.8c61,0,110.5-49.6,110.5-110.8 C334.5,64.5,285,14.9,224,14.9L224,14.9z'
                    fill='#FFFFFF'
                />
                <path
                    d='M154.1,125.4c0.1-29.9,18.7-55.4,45-65.5v131C172.8,180.8,154.2,155.3,154.1,125.4L154.1,125.4z M249.3,190.9 V59.9c26.3,10.1,45,35.6,45,65.5C294.2,155.3,275.5,180.8,249.3,190.9L249.3,190.9z'
                    fill='#0079BE'
                />
            </svg>
        );
    }

    if (name === 'amex') {
        return (
            <svg
                height={20}
                version='1.1'
                viewBox='0 0 500 250'
                width={25}
                xmlns='http://www.w3.org/2000/svg'
            >
                <title>amex</title>
                <path
                    d='M367.2,57.4l-9.4,21.7h18.8L367.2,57.4z M259.2,70.9c1.8-0.9,2.8-2.8,2.8-5.2c0-2.3-1.1-4-2.9-4.8 c-1.6-0.9-4.1-1-6.4-1H236V72h16.5C255.1,72,257.3,71.9,259.2,70.9z M44.7,57.4l-9.3,21.7H54L44.7,57.4z M475.4,196.6h-26.3v-11.7 h26.1c2.6,0,4.4-0.3,5.5-1.4c1-0.9,1.6-2.2,1.6-3.6c0-1.6-0.7-2.8-1.7-3.6c-1-0.8-2.4-1.2-4.8-1.2c-12.8-0.4-28.7,0.4-28.7-16.9 c0-7.9,5.2-16.2,19.5-16.2h27.1v-10.8h-25.2c-7.6,0-13.1,1.7-17,4.5v-4.5h-37.2c-6,0-12.9,1.4-16.2,4.5v-4.5h-66.5v4.5 c-5.3-3.7-14.2-4.5-18.3-4.5h-43.8v4.5c-4.2-3.9-13.5-4.5-19.2-4.5h-49.1l-11.2,11.6l-10.5-11.6h-73.3v76.1h71.9l11.6-11.8 l10.9,11.8l44.3,0v-17.9h4.4c5.9,0.1,12.8-0.1,18.9-2.7v20.5h36.6v-19.8h1.8c2.2,0,2.5,0.1,2.5,2.2v17.6h111.1 c7.1,0,14.4-1.7,18.5-4.9v4.9h35.2c7.3,0,14.5-1,19.9-3.5v-14.2C490.6,194.2,484.1,196.6,475.4,196.6L475.4,196.6z M250,178.6h-17 v18.3h-26.4l-16.7-18l-17.4,18h-53.9v-54.5h54.7l16.7,17.9l17.3-17.9h43.4c10.8,0,22.9,2.9,22.9,18 C273.7,175.5,261.9,178.6,250,178.6L250,178.6z M331.6,176.1c1.9,2.7,2.2,5.1,2.3,9.9v10.8h-13.7v-6.8c0-3.3,0.3-8.1-2.2-10.7 c-2-2-5-2.4-10-2.4h-14.5v19.9h-13.7v-54.5h31.4c6.9,0,11.9,0.3,16.4,2.6c4.3,2.5,7,5.9,7,12.1c0,8.7-6.1,13.1-9.6,14.5 C327.9,172.6,330.4,174.6,331.6,176.1L331.6,176.1z M387.7,153.7h-31.8v9.9h31.1v11.1h-31.1v10.8l31.8,0v11.3h-45.4v-54.5h45.4 V153.7z M422.7,196.9h-26.5v-11.7h26.4c2.6,0,4.4-0.3,5.6-1.4c0.9-0.8,1.6-2.1,1.6-3.6c0-1.6-0.7-2.9-1.7-3.6 c-1-0.8-2.5-1.2-4.8-1.2c-12.7-0.4-28.6,0.4-28.6-16.9c0-7.9,5.2-16.2,19.4-16.2h27.3V154h-24.9c-2.5,0-4.1,0.1-5.4,1 c-1.5,0.9-2,2.2-2,3.9c0,2.1,1.3,3.5,3,4.1c1.4,0.5,3,0.6,5.3,0.6l7.3,0.2c7.4,0.2,12.4,1.4,15.5,4.4c2.6,2.6,4.1,5.9,4.1,11.5 C444,191.4,436.4,196.9,422.7,196.9L422.7,196.9z M317.2,154.5c-1.6-0.9-4.1-1-6.5-1H294v12.2h16.5c2.6,0,4.9-0.1,6.7-1.1 c1.8-1,2.8-2.9,2.8-5.2S319,155.4,317.2,154.5L317.2,154.5z M469.1,153.6c-2.5,0-4.1,0.1-5.5,1c-1.4,0.9-2,2.2-2,3.9 c0,2.1,1.2,3.5,3,4.1c1.4,0.5,3,0.6,5.2,0.6l7.4,0.2c7.4,0.2,12.4,1.4,15.4,4.4c0.6,0.4,0.9,0.9,1.3,1.3v-15.5L469.1,153.6 L469.1,153.6z M250.5,153.6h-17.7v13.9h17.6c5.2,0,8.5-2.5,8.5-7.2C258.8,155.5,255.4,153.6,250.5,153.6z M132.1,153.6v9.9H162v11.1 h-29.8v10.8h33.4l15.5-16l-14.9-15.9H132.1z M219.4,191.7V148l-20.9,21.5L219.4,191.7L219.4,191.7z M133.3,104.2v9.4h113.6 l-0.1-19.9h2.2c1.5,0.1,2,0.2,2,2.6v17.2h58.7v-4.6c4.7,2.4,12.1,4.6,21.8,4.6h24.7l5.3-12.1h11.7l5.2,12.1h47.6V102l7.2,11.5h38.2 v-76h-37.8v9l-5.3-9h-38.8v9l-4.9-9h-52.4c-8.8,0-16.5,1.2-22.7,4.4v-4.4h-36.1V42c-4-3.4-9.4-4.4-15.4-4.4h-132l-8.9,19.6 l-9.1-19.6H66.8v9l-4.6-9H26.7L10.3,73.7v28.9l24.3-54.5h20.2l23.1,51.6V48.1h22.2l17.8,37l16.3-37h22.6v54.5H143l-0.1-42.7 l-19.7,42.7h-11.9L91.5,59.9v42.7H63.9l-5.2-12.2H30.3L25,102.6H10.3v11h23.2l5.2-12.1h11.7l5.2,12.1h45.7v-9.3l4.1,9.3h23.7 L133.3,104.2L133.3,104.2z M312.3,54.4c4.4-4.3,11.3-6.4,20.6-6.4h13.2v11.7h-12.9c-5,0-7.8,0.7-10.5,3.2c-2.3,2.3-3.9,6.6-3.9,12.3 c0,5.8,1.2,10,3.7,12.8c2.1,2.2,5.9,2.8,9.5,2.8h6.1l19.2-42.9h20.4l23,51.5V48.1h20.7l23.9,38v-38h13.9v54.5H440l-25.8-40.9v40.9 h-27.7l-5.3-12.2H353l-5.1,12.2h-15.9c-6.6,0-15-1.4-19.7-6c-4.8-4.6-7.3-10.9-7.3-20.8C304.9,67.7,306.4,60.3,312.3,54.4 L312.3,54.4z M284.3,48.1h13.9v54.5h-13.9V48.1z M221.8,48.1H253c6.9,0,12.1,0.2,16.5,2.6c4.3,2.4,6.9,6,6.9,12.1 c0,8.7-6.1,13.2-9.6,14.5c3,1.1,5.5,3,6.7,4.6c1.9,2.7,2.3,5.1,2.3,10v10.7h-13.7l-0.1-6.9c0-3.3,0.3-8-2.1-10.6 c-2-1.9-5-2.3-9.9-2.3h-14.6v19.8h-13.6L221.8,48.1L221.8,48.1z M167,48.1h45.4v11.3h-31.8v9.8h31.1v11.2h-31.1v10.9h31.8v11.3H167 V48.1z'
                    fill='#2557D6'
                />
            </svg>
        );
    }

    return <GrCreditCard size={15} style={{ opacity: 0.6 }} />;
};

const InputCreditCard: React.FC<InputProps> = ({ onChange, ...props }) => {
    const [flag, setFlag] = useState('');

    return (
        <Input
            inputMode='numeric'
            maxLength={20}
            onChange={(e) => {
                setFlag(company(e?.target?.value));
                if (onChange) {
                    onChange(e);
                }
            }}
            suffix={<Flag name={flag} />}
            {...props}
        />
    );
};

export default InputCreditCard;
